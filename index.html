
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Bob's Mansion Horror</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; color: white; }
    canvas { display: block; }
    #instructions {
      position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.7); padding: 10px; z-index: 10;
    }
  </style>
</head>
<body>
  <div id="instructions">Use WASD or touch to move. Tap/click to look. Avoid the monsters!</div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    let renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Ground
    let floorGeometry = new THREE.PlaneGeometry(100, 100);
    let floorMaterial = new THREE.MeshBasicMaterial({ color: 0x222222 });
    let floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);

    // Lighting
    let ambientLight = new THREE.AmbientLight(0x404040);
    scene.add(ambientLight);
    let pointLight = new THREE.PointLight(0xffffff, 1, 15);
    scene.add(pointLight);

    // Player setup
    camera.position.y = 1.6;
    let velocity = new THREE.Vector3();

    // Monsters
    const monsters = [];
    const monsterNames = ["The Lurker", "The Watcher", "The Crawler", "The Screecher", "The Shadow"];
    const monsterColors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff];
    const scream = new Audio("https://www.soundjay.com/human/screaming-woman-01.mp3");

    for (let i = 0; i < 5; i++) {
      let geometry = new THREE.SphereGeometry(0.5, 16, 16);
      let material = new THREE.MeshBasicMaterial({ color: monsterColors[i] });
      let monster = new THREE.Mesh(geometry, material);
      monster.position.set(Math.random()*20-10, 0.5 + (i === 2 ? 0.1 : 1.0), Math.random()*-20);
      monster.name = monsterNames[i];
      scene.add(monster);
      monsters.push(monster);
    }

    function animate() {
      requestAnimationFrame(animate);

      // Monster behavior
      monsters.forEach((monster, i) => {
        let dist = monster.position.distanceTo(camera.position);
        if (i === 0 && dist < 10) { // Lurker chases
          let dir = camera.position.clone().sub(monster.position).normalize();
          monster.position.add(dir.multiplyScalar(0.02));
        }
        if (i === 4 && Math.random() < 0.005) { // Shadow teleports
          monster.position.set(Math.random()*20-10, 1.0, Math.random()*-20);
        }
        if (dist < 1.5) {
          scream.play();
          camera.position.set(0, 1.6, 0); // respawn
        }
      });

      pointLight.position.copy(camera.position);
      renderer.render(scene, camera);
    }

    // Movement
    const keys = {};
    document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    function handleMovement() {
      const speed = 0.1;
      if (keys['w']) camera.position.z -= speed;
      if (keys['s']) camera.position.z += speed;
      if (keys['a']) camera.position.x -= speed;
      if (keys['d']) camera.position.x += speed;
    }

    // Mouse/touch look
    let yaw = 0, pitch = 0;
    function setupLook() {
      let dragging = false, lastX, lastY;
      document.addEventListener("mousedown", e => { dragging = true; lastX = e.clientX; lastY = e.clientY; });
      document.addEventListener("mouseup", () => dragging = false);
      document.addEventListener("mousemove", e => {
        if (!dragging) return;
        yaw -= (e.clientX - lastX) * 0.002;
        pitch -= (e.clientY - lastY) * 0.002;
        pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));
        lastX = e.clientX; lastY = e.clientY;
      });
    }

    function updateCameraRotation() {
      camera.rotation.order = "YXZ";
      camera.rotation.y = yaw;
      camera.rotation.x = pitch;
    }

    function gameLoop() {
      handleMovement();
      updateCameraRotation();
      animate();
    }

    setupLook();
    gameLoop();
  </script>
</body>
</html>
